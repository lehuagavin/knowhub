# 第三章 分布式系统 - 习题

## 一、选择题

### 1. 关于CAP定理，以下说法正确的是？
A. 一个分布式系统可以同时满足一致性、可用性和分区容错性
B. 分区容错性在分布式系统中是可以放弃的
C. CAP定理指出在网络分区发生时，系统必须在一致性和可用性之间做选择
D. CP系统在任何情况下都不可用

### 2. 关于两阶段提交（2PC），以下说法错误的是？
A. 协调者故障可能导致参与者长时间阻塞
B. 2PC可以保证强一致性
C. 2PC的第一阶段参与者执行事务但不提交
D. 2PC不需要持久化日志即可保证正确性

### 3. TCC模式中，"空回滚"问题是指？
A. Cancel操作执行了两次
B. Try请求未到达参与者，但Cancel请求先到达并执行
C. Confirm操作失败后的回滚
D. Try操作超时后自动回滚

### 4. 在Raft算法中，以下哪个不是节点的合法状态？
A. Follower
B. Candidate
C. Leader
D. Observer

### 5. 关于Saga模式，以下说法正确的是？
A. Saga保证强一致性
B. 编排式Saga需要一个中心协调器
C. 补偿事务必须是幂等的
D. Saga不需要考虑补偿失败的情况

### 6. Paxos算法中，当Proposer收到多数派的Promise响应，且其中包含已接受的值时，Proposer应该？
A. 使用自己提议的值
B. 使用编号最大的已接受值
C. 随机选择一个值
D. 重新发起Prepare

---

## 二、简答题

### 7. 请解释BASE理论的含义，并说明它与ACID的区别。举一个实际系统中应用BASE理论的例子。

### 8. 比较2PC和TCC两种分布式事务方案的优缺点，分别适用于什么场景？

### 9. 请描述Raft算法的Leader选举流程。为什么Raft使用随机化的选举超时时间？

### 10. 解释什么是"脑裂"（Split Brain）问题，在分布式系统中如何避免？

---

## 三、设计题

### 11. 分布式锁设计
请设计一个基于Redis的分布式锁，要求：
- 互斥性：同一时刻只有一个客户端能持有锁
- 防死锁：持有锁的客户端崩溃后，锁能自动释放
- 可重入：同一个客户端可以多次获取同一把锁
- 请写出加锁和解锁的伪代码，并说明需要注意的问题

### 12. 最终一致性方案设计
电商系统中，用户下单后需要：扣减库存、扣减余额、创建物流单。请设计一个基于Saga模式的最终一致性方案，要求：
- 画出正常流程和补偿流程
- 说明每个步骤的补偿操作
- 如何处理补偿操作失败的情况
