---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/content/Breadcrumb.astro';
import { presentations, getPresentation } from '../../data/presentations';
import { url } from '../../utils/path';
import type { GetStaticPaths } from 'astro';

// 加载所有演示文稿 MDX 内容
const contentFiles = import.meta.glob('/src/content/presentations/*.mdx', { eager: true }) as Record<
  string,
  { Content: any; default: { Content: any } }
>;

export const getStaticPaths = (() => {
  return presentations.map((pres) => ({
    params: { slug: pres.slug },
  }));
}) satisfies GetStaticPaths;

const { slug } = Astro.params;
const presentation = getPresentation(slug);

if (!presentation) {
  return Astro.redirect(url('/presentations'));
}

// 查找对应的 MDX 内容
const contentKey = `/src/content/presentations/${slug}.mdx`;
const contentModule = contentFiles[contentKey];
const Content = contentModule?.Content || contentModule?.default?.Content;

const breadcrumbItems = [
  { name: '演示文稿', href: url('/presentations') },
  { name: presentation.title },
];

const formattedDate = new Date(presentation.date).toLocaleDateString('zh-CN', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={presentation.title} description={presentation.description}>
  <section class="presentation-page">
    <div class="container">
      <Breadcrumb items={breadcrumbItems} />

      <header class="presentation-header">
        <h1 class="presentation-title">{presentation.title}</h1>
        <p class="presentation-description">{presentation.description}</p>
        <div class="presentation-meta">
          <span class="presentation-date">{formattedDate}</span>
          <span class="presentation-slides">{presentation.slideCount} 页幻灯片</span>
        </div>
        {presentation.tags && (
          <div class="presentation-tags">
            {presentation.tags.map((tag) => (
              <span class="presentation-tag">{tag}</span>
            ))}
          </div>
        )}
      </header>

      <div class="presentation-content">
        {Content ? (
          <Content />
        ) : (
          <p class="placeholder-text">演示文稿内容即将更新...</p>
        )}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .presentation-page {
    padding: var(--space-8) 0 var(--space-24);
  }

  .presentation-header {
    text-align: center;
    margin-bottom: var(--space-10);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .presentation-title {
    font-size: clamp(1.75rem, 3.5vw, 2.5rem);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--space-3);
    line-height: 1.3;
  }

  .presentation-description {
    font-size: 1.0625rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: var(--space-4);
  }

  .presentation-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }

  .presentation-date,
  .presentation-slides {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }

  .presentation-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .presentation-tag {
    font-size: 0.8125rem;
    padding: 0.25rem 0.75rem;
    background: var(--surface);
    color: var(--text-secondary);
    border-radius: var(--radius-full);
    font-weight: 500;
  }

  .presentation-content {
    max-width: 1000px;
    margin: 0 auto;
  }

  .placeholder-text {
    text-align: center;
    padding: var(--space-16) 0;
    color: var(--text-secondary);
    font-style: italic;
  }
</style>
